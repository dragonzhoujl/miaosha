<mapper namespace="com.qiyue.miaosha.dao.SecKillDao">
	<update id="reduceNumber">
		update seckill set number=number-1 where seckill_id=#{seckillId}
		and start_time<![CDATA[<=]]>#{killTime}
		and end_time>=#{killTime}
		and number>0
	</update>
	<select id="queryById" resultType="SecKill" parameterType="long">
		select seckill_id,name,number,start_time,end_time,create_time from seckill 
		 where seckill_id =#{seckillId} 
	</select>
	<select id ="queryAll" resultType="SecKill">
		select seckill_id,name,number,start_time,end_time,create_time from seckill 
		order by create_time desc
		limit #{offset},#{limit}  
	</select>
	<select id ="seckillByProcedure" statementType="CALLABLE">
		call execute_seckill(
			#{seckillId,jdbcType=BIGINT,mode=IN},
			#{phone,jdbcType=BIGINT,mode=IN},
			#{killTime,jdbcType=TIMESTAMP,mode=IN},
			#{result,jdbcType=INTEGER,mode=IN}
			
		)
	</select>
</mapper>